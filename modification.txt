dans le chemin : cart/views.py 



nouvelle code : 

@login_required
def cart_add(request, bookid):
    cart = Cart(request)  
    book = get_object_or_404(Book, id=bookid)
    cart.add(request=request, book=book)
    messages.success(request, "Le livre a été ajouté à votre panier!")
    return redirect('store:index')

oncient 

def cart_add(request, bookid):
	cart = Cart(request)  
	book = get_object_or_404(Book, id=bookid) 
	cart.add(book=book)

	return redirect('store:index')

-----------------------------------------------
dans le chemin : cart/cart.py 


nouvelle code :  def add(self, book, request):
        if request.user.is_authenticated:
            book_id = str(book.id)
            if book.is_available() and book_id not in self.cart:
                self.cart[book_id] = {'quantity': 0, 'price': str(book.price)}
            self.cart[book_id]['quantity'] = 1
        else:
            if self.cart[book_id]['quantity'] < 1:
                self.cart[book_id]['quantity'] += 1
            self.save()
            messages.warning(request, "Vous devez être connecté pour ajouter des livres à votre panier!")

ancient code : 

 def add(self, book):
        # if request.user.is_authenticated:
            book_id = str(book.id)
            if book.is_available() and book_id not in self.cart:
                self.cart[book_id] = {'quantity': 0, 'price': str(book.price)}
                self.cart[book_id]['quantity'] = 1
            else:    
                if self.cart[book_id]['quantity'] < 1:
                    self.cart[book_id]['quantity'] += 1
            
            self.save()
        # badr salhielse:
        #     return redirect('store:signin')




















-------------------

dans le fichie index.html  

nouvel : 

 <button class="btn btn-warning" id="addTocart" onclick="window.location.href='/cart/add/{{ p.id }}'">
        <i class="fa fa-shopping-cart"></i>Ajouter au panier
    </button>
{% else %}
    <a href="{% url 'store:signin' %}" class="btn btn-warning">
        <i class="fa fa-sign-in"></i> Se connecter pour ajouter au panier
    </a>
{% endif %}




ancien : 

<button class="btn btn-warning" id="addTocart" data-book-id="{{ p.id }}"
<i class="fa fa-shopping-cart""></i>Ajouter au panier
</button>